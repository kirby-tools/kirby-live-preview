(function(){"use strict";const e=window.Vue;function S(){return window.panel}function $(){return S().api}function F(){const n=$();return{load:({parent:o,name:t})=>n.get(`${o}/sections/${t}`)}}function G(){var r;return((r=e.getCurrentInstance())==null?void 0:r.proxy).$store}const H=e.computed;e.customRef,e.defineAsyncComponent,e.defineComponent,e.effectScope,e.getCurrentInstance,e.getCurrentScope,e.h,e.inject,e.isProxy,e.isReactive,e.isReadonly,e.isRef,e.isShallow,e.markRaw;const O=e.nextTick;e.onActivated,e.onBeforeMount;const J=e.onBeforeUnmount;e.onBeforeUpdate,e.onDeactivated,e.onErrorCaptured,e.onMounted,e.onRenderTracked,e.onRenderTriggered,e.onScopeDispose,e.onServerPrefetch,e.onUnmounted,e.onUpdated,e.provide,e.proxyRefs,e.reactive,e.readonly;const l=e.ref;e.shallowReactive,e.shallowReadonly,e.shallowRef,e.toRaw,e.toRef,e.toRefs,e.triggerRef,e.unref,e.useAttrs,e.useCssModule,e.useCssVars,e.useListeners,e.useSlots;const A=e.watch;e.watchEffect,e.watchPostEffect,e.watchSyncEffect;function X(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Y(n,r){let o,t=0;return function(...c){clearTimeout(o);const d=Date.now(),g=d-t,s=r-g;s<=0?(t=d,n.apply(this,c)):o=setTimeout(()=>{t=Date.now(),n.apply(this,c)},s)}}var q=Y;const K=X(q),Q=/\/$|\/\?|\/#/,Z=/^\.?\//;function ee(n="",r){return r?Q.test(n):n.endsWith("/")}function te(n="",r){if(!r)return n.endsWith("/")?n:n+"/";if(ee(n,!0))return n||"/";let o=n,t="";const a=n.indexOf("#");if(a>=0&&(o=n.slice(0,a),t=n.slice(a),!o))return t;const[c,...d]=o.split("?");return c+"/"+(d.length>0?`?${d.join("?")}`:"")+t}function ne(n=""){return n.startsWith("/")}function j(n=""){return ne(n)?n:"/"+n}function oe(n){return n&&n!=="/"}function re(n,...r){let o=n||"";for(const t of r.filter(a=>oe(a)))if(o){const a=t.replace(Z,"");o=te(o)+a}else o=t;return o}const se={blueprint:String,lock:[Boolean,Object],help:String,name:String,parent:String,timestamp:Number};function ae(){const r=S().languages.map(t=>t.code);return{locales:r,getNonLocalizedPath:t=>{const c=(t instanceof URL?t:new URL(t)).pathname.split("/").filter(Boolean);return r.includes(c[0])&&c.shift(),j(c.join("/"))}}}const ie=["error","warn","info","debug"];function le(n,r,o,t,a,c,d,g){var s=typeof n=="function"?n.options:n;r&&(s.render=r,s.staticRenderFns=o,s._compiled=!0),t&&(s.functional=!0),c&&(s._scopeId="data-v-"+c);var p;if(d?(p=function(u){u=u||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!u&&typeof __VUE_SSR_CONTEXT__<"u"&&(u=__VUE_SSR_CONTEXT__),a&&a.call(this,u),u&&u._registeredComponents&&u._registeredComponents.add(d)},s._ssrRegister=p):a&&(p=g?function(){a.call(this,(s.functional?this.parent:this).$root.$options.shadowRoot)}:a),p)if(s.functional){s._injectStyles=p;var L=s.render;s.render=function(m,b){return p.call(b),L(m,b)}}else{var k=s.beforeCreate;s.beforeCreate=k?[].concat(k,p):[p]}return{exports:n,options:s}}const B={...se},ce=Object.assign({inheritAttrs:!1},{__name:"Preview",props:B,setup(n){const r=n,o=S(),t=$(),a=G(),{getNonLocalizedPath:c}=ae(),d=l(),g=l(),s=l(),p=l(),L=l(),k=l(),u=l(!1),m=l(!1),b=l(!1),R=l(),I=l(),P=l({}),N=l(),y=l(),W=l();let w;const U=H(()=>a.getters["content/changes"]());A(U,(i,f)=>{w&&g.value!==!1&&JSON.stringify(i)!==JSON.stringify(f)&&w(i)},{deep:!0}),A(()=>o.language.code,()=>{_()}),(async()=>{const{load:i}=F(),f=await i({parent:r.parent,name:r.name});d.value=z(f.label)||o.t("johannschopplich.preview.label"),g.value=f.updateInterval,s.value=f.interactable,p.value=f.aspectRatio||void 0,L.value=f.help,k.value=ie.indexOf(f.logLevel),w=K(x,g.value||250),_(),await O(),p.value||(C(),window.addEventListener("resize",C)),window.addEventListener("message",E),o.events.on("page.changeTitle",_),o.events.on("file.sort",_)})(),J(()=>{window.removeEventListener("resize",C),window.removeEventListener("message",E),o.events.off("page.changeTitle",_),o.events.off("file.sort",_),R.value&&URL.revokeObjectURL(R.value)});function C(){P.value=N.value.getBoundingClientRect()}function _(i){w==null||w(U.value,i)}async function x(i,{persistScrollPosition:f=!0}={}){var D,M;if(u.value)return;u.value=!0;const h=o.view.path.startsWith("pages/")?o.view.path.slice(6).replaceAll("+","/"):void 0;let v=0;y.value&&(v=y.value.contentWindow.scrollY,(M=(D=W.value)==null?void 0:D.contentWindow)==null||M.scrollTo(0,v)),m.value=!0;try{const{html:T}=await t.post("__live-preview__/render",{id:h,content:i,interactable:s.value}),V=R.value,ve=new Blob([T],{type:"text/html"});R.value=URL.createObjectURL(ve),await O(),await new Promise(he=>{y.value.addEventListener("load",()=>{v&&f&&y.value.contentWindow.scrollTo(0,v),he()},{once:!0})}),m.value=!1,b.value=!1,I.value=R.value,V&&URL.revokeObjectURL(V)}catch(T){console.error(T),b.value=!0,m.value=!1}finally{u.value=!1}}async function E({data:i}){if(i.type==="save"){o.events.emit(`${o.context}.save`);return}if(i.type==="link"){const f=new URL(i.href);if(f.origin!==window.location.origin){window.open(i.href,"_blank");return}if(["assets","media"].some(v=>f.pathname.startsWith(`/${v}/`)))return;let h=c(f).slice(1);h?(h=h.replace(/\/[^\/]+?:.+$/,""),h=re("pages",h.replaceAll("/","+"))):h="site";try{o.isLoading=!0;const v=await o.get(j(h));o.set(v),o.isLoading=!1}catch(v){console.error(v)}}}function z(i){return!i||typeof i=="string"?i:i[o.translation.code]??Object.values(i)[0]}return{__sfc:!0,propsDefinition:B,props:r,panel:o,api:t,store:a,getNonLocalizedPath:c,label:d,updateInterval:g,interactable:s,aspectRatio:p,help:L,logLevel:k,isRendering:u,showTransitionIframe:m,hasError:b,blobUrl:R,transitionBlobUrl:I,containerRect:P,container:N,iframe:y,transitionIframe:W,throttledRenderPreview:w,unsavedContent:U,updateSectionHeight:C,renderUnsavedContent:_,renderPreview:x,handleMessage:E,t:z}}});var ue=function(){var r=this,o=r._self._c,t=r._self._setupProxy;return o("k-section",{attrs:{label:t.label}},[o("k-button-group",{attrs:{slot:"options",layout:"collapsed"},slot:"options"},[o("k-button",{attrs:{variant:"filled",size:"xs",icon:"live-preview-restart"},on:{click:function(a){return t.renderUnsavedContent()}}})],1),o("div",{ref:"container",staticClass:"klp-grid klp-min-h-[55dvh] klp-rounded-[var(--input-rounded)]",class:[t.isRendering&&"klp-pointer-events-none",t.transitionBlobUrl&&!t.hasError&&"k-shadow-md",(!t.transitionBlobUrl||t.hasError)&&"klp-border klp-border-dashed klp-border-[var(--color-gray-400)]"],style:{aspectRatio:t.aspectRatio,height:t.aspectRatio?"auto":`calc(100dvh - ${t.containerRect.top??0}px - var(--spacing-3))`},attrs:{"data-theme":"passive"}},[t.transitionBlobUrl?o("iframe",{ref:"transitionIframe",staticClass:"klp-h-full klp-w-full klp-rounded-[var(--input-rounded)] klp-bg-white",class:[t.hasError&&"klp-pointer-events-none klp-opacity-0"],style:{gridArea:"1 / 1 / 1 / 1"},attrs:{src:t.transitionBlobUrl}}):r._e(),t.blobUrl?o("iframe",{ref:"iframe",staticClass:"klp-h-full klp-w-full klp-rounded-[var(--input-rounded)] klp-bg-white",class:[(t.showTransitionIframe||t.hasError)&&"klp-pointer-events-none klp-opacity-0"],style:{gridArea:"1 / 1 / 1 / 1"},attrs:{src:t.blobUrl}}):r._e(),t.hasError?o("div",{staticClass:"klp-flex klp-items-center klp-justify-center",style:{gridArea:"1 / 1 / 1 / 1"}},[o("k-button",{attrs:{variant:"filled",theme:"notice",icon:"alert",text:t.panel.t("johannschopplich.preview.error.render")},on:{click:function(a){return t.renderUnsavedContent({persistScrollPosition:!1})}}})],1):r._e()]),t.help?o("k-text",{staticClass:"k-help klp-mt-2",attrs:{html:t.help}}):r._e()],1)},fe=[],pe=le(ce,ue,fe,!1,null,"02dcf2c7",null,null);const de=pe.exports;window.panel.plugin("johannschopplich/live-preview",{sections:{preview:de},icons:{"live-preview-restart":'<path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772z" />'}})})();
