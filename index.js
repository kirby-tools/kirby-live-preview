(function(){"use strict";function b(){return window.panel}function U(){return b().api}function Y(){const o=U();return{load:({parent:e,name:t})=>o.get(`${e}/sections/${t}`)}}function X(){return b().app.$store}const n=window.Vue,Z=n.computed;n.customRef,n.defineAsyncComponent,n.defineComponent,n.effectScope,n.getCurrentInstance,n.getCurrentScope,n.h,n.inject,n.isProxy,n.isReactive,n.isReadonly,n.isRef,n.isShallow,n.markRaw;const A=n.nextTick;n.onActivated,n.onBeforeMount;const ee=n.onBeforeUnmount;n.onBeforeUpdate,n.onDeactivated,n.onErrorCaptured,n.onMounted,n.onRenderTracked,n.onRenderTriggered,n.onScopeDispose,n.onServerPrefetch,n.onUnmounted,n.onUpdated,n.provide,n.proxyRefs,n.reactive,n.readonly;const l=n.ref;n.shallowReactive,n.shallowReadonly,n.shallowRef,n.toRaw,n.toRef,n.toRefs,n.triggerRef;const T=n.unref;n.useAttrs,n.useCssModule,n.useCssVars,n.useListeners,n.useSlots;const $=n.watch;n.watchEffect,n.watchPostEffect,n.watchSyncEffect;const I={en:{"modal.info":"Thanks for purchasing {label}! Please enter your email address and order ID to activate your license.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Find your order number</a> on Lemon Squeezy or <a href="mailto:hello@kirby.tools">contact us</a> if you cannot find it.',"modal.error.required.fields":"Email address and order ID are required","modal.error.invalid.unauthorized":"Email address or order ID is incorrect","modal.error.invalid.licenseKey":"License key invalid for this plugin","modal.error.incompatible.licenseKey":"License key invalid for this plugin version","modal.error.registered":"License key already registered",activate:"Activate",activated:"Plugin activated"},de:{"modal.info":"Dankeschön für den Kauf von {label}! Bitte gib deine E-Mail-Adresse und Bestellnummer ein, um deine Lizenz zu aktivieren.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Finde deine Bestellnummer</a> bei Lemon Squeezy oder <a href="mailto:hello@kirby.tools">kontaktiere uns</a>, wenn du sie nicht finden kannst.',"modal.error.required.fields":"E-Mail-Adresse und Bestellnummer sind notwendig","modal.error.invalid.unauthorized":"E-Mail-Adresse oder Bestellnummer ist falsch","modal.error.invalid.licenseKey":"Lizenzschlüssel ungültig für dieses Plugin","modal.error.incompatible.licenseKey":"Lizenzschlüssel ungültig für diese Plugin-Version","modal.error.registered":"Lizenzschlüssel bereits registriert",activate:"Aktivieren",activated:"Plugin aktiviert"},fr:{"modal.info":"Merci d'avoir acheté {label} ! Veuillez saisir votre adresse e-mail et votre numéro de commande pour activer votre licence.","modal.fields.orderId.help":'<a href="https://app.lemonsqueezy.com/my-orders" target="_blank">Trouvez votre numéro de commande</a> sur Lemon Squeezy ou <a href="mailto:hello@kirby.tools">contactez-nous</a> si vous ne le trouvez pas.',"modal.error.required.fields":"Adresse e-mail et numéro de commande requis","modal.error.invalid.unauthorized":"Adresse e-mail ou numéro de commande incorrect","modal.error.invalid.licenseKey":"Clé de licence invalide pour ce plugin","modal.error.incompatible.licenseKey":"Clé de licence invalide pour cette version du plugin","modal.error.registered":"Clé de licence déjà enregistrée",activate:"Activer",activated:"Plugin activé"}};function h(o,r,e){var v;const a=b().translation.code,c=((v=I==null?void 0:I[a])==null?void 0:v[o])??e;if(c)return r?te(c,r):c}function te(o,r,e){return o.replace(/\{(\w+)\}/g,(t,a)=>r[a]||a)}const ne=["localhost","127.0.0.1","[::1]"],oe=["local","test","ddev.site"];function re({label:o,apiNamespace:r}){const e=b(),t=U(),a=ie(),c=async(s,f)=>{if(!s||!f)throw new Error("Email and order ID are required");const d=await t.post(`${r}/register`,{email:s,orderId:f});if((d==null?void 0:d.status)!=="ok")throw new Error("Registration failed");return!0};return{isLocalhost:a,assertActivationIntegrity:async({component:s,licenseStatus:f})=>{if(T(f)==="active")return;await A();const d=T(s);if(!(d!=null&&d.$el)||window.getComputedStyle(d.$el).display==="none"||window.getComputedStyle(d.$el).visibility==="hidden"||window.getComputedStyle(d.$el).opacity==="0")throw new Error("Are you trying to hide the activation buttons? Please buy a license.")},openLicenseModal:()=>{let s=!1;return new Promise(f=>{e.dialog.open({component:"k-form-dialog",props:{submitButton:{icon:"check",theme:"love",text:h("activate",{label:o})},fields:{info:{type:"info",text:h("modal.info",{label:o})},email:{label:e.t("email"),type:"email"},orderId:{label:"Order ID",type:"text",help:h("modal.fields.orderId.help",{label:o})}}},on:{close:()=>{f({isRegistered:s})},submit:async d=>{const{email:L,orderId:E}=d;if(!L||!E){e.notification.error(h("modal.error.required.fields"));return}try{await c(L,Number(E))}catch(x){let p=x.message;p==="Unauthorized"?p=h("modal.error.invalid.unauthorized"):p==="License key not valid for this plugin"?p=h("modal.error.invalid.licenseKey"):p==="License key not valid for this plugin version"?p=h("modal.error.incompatible.licenseKey"):p==="License key already registered"&&(p=h("modal.error.registered")),e.notification.error(p);return}s=!0,e.dialog.close(),e.notification.success(h("activated"))}}})})}}}function ie(){const{hostname:o}=window.location,r=ne.includes(o),e=oe.some(t=>o.endsWith(`.${t}`));return r||e}const ae={blueprint:String,lock:[Boolean,Object],help:String,name:String,parent:String,timestamp:Number};function se(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function le(o,r){if(typeof o!="function")throw new TypeError(`Expected the first argument to be a \`function\`, got \`${typeof o}\`.`);let e,t=0;return function(...c){clearTimeout(e);const v=Date.now(),k=v-t,s=r-k;s<=0?(t=v,o.apply(this,c)):e=setTimeout(()=>{t=Date.now(),o.apply(this,c)},s)}}var ce=le;const de=se(ce),ue=/^\.?\//;function pe(o="",r){return o.endsWith("/")?o:o+"/"}function fe(o=""){return o.startsWith("/")}function F(o=""){return fe(o)?o:"/"+o}function ve(o){return o&&o!=="/"}function me(o,...r){let e=o||"";for(const t of r.filter(a=>ve(a)))if(e){const a=t.replace(ue,"");e=pe(e)+a}else e=t;return e}function he(){const r=b().languages.map(t=>t.code);return{locales:r,getNonLocalizedPath:t=>{const c=(t instanceof URL?t:new URL(t)).pathname.split("/").filter(Boolean);return r.includes(c[0])&&c.shift(),F(c.join("/"))}}}const ge=["error","warn","info","debug"];function we(o,r,e,t,a,c,v,k){var s=typeof o=="function"?o.options:o;return r&&(s.render=r,s.staticRenderFns=e,s._compiled=!0),s._scopeId="data-v-"+c,{exports:o,options:s}}const M={...ae},ye=Object.assign({inheritAttrs:!1},{__name:"Preview",props:M,setup(o){const r=o,e=b(),t=U(),a=X(),{getNonLocalizedPath:c}=he(),{openLicenseModal:v,assertActivationIntegrity:k}=re({label:"Kirby Live Preview",apiNamespace:"__live-preview__"}),s=l(),f=l(),d=l(),L=l(),E=l(),x=l(),p=l(),C=l(!1),S=l(!1),P=l(!1),_=l(),D=l(),q=l({}),N=l(),R=l(),K=l(),W=l();let w;const B=Z(()=>a.getters["content/changes"]());$(B,(i,u)=>{w&&f.value!==!1&&JSON.stringify(i)!==JSON.stringify(u)&&w(i)},{deep:!0}),$(()=>e.language.code,()=>{y()}),(async()=>{const{load:i}=Y(),u=await i({parent:r.parent,name:r.name});s.value=G(u.label)||e.t("johannschopplich.preview.label"),f.value=u.updateInterval,d.value=u.interactable,L.value=u.aspectRatio||void 0,E.value=ge.indexOf(u.logLevel),x.value=u.help,p.value=u.license,k({component:W,licenseStatus:p.value}),w=de(V,f.value||250),y(),await A(),L.value||(z(),window.addEventListener("resize",z)),window.addEventListener("message",j),e.events.on("page.changeTitle",y),e.events.on("file.sort",y)})(),ee(()=>{window.removeEventListener("resize",z),window.removeEventListener("message",j),e.events.off("page.changeTitle",y),e.events.off("file.sort",y),_.value&&URL.revokeObjectURL(_.value)});function z(){q.value=N.value.getBoundingClientRect()}function y(i){w==null||w(B.value,i)}async function V(i,{persistScrollPosition:u=!0}={}){var H,J;if(C.value)return;C.value=!0;const g=e.view.path.startsWith("pages/")?e.view.path.slice(6).replaceAll("+","/"):void 0;let m=0;R.value&&(m=R.value.contentWindow.scrollY,(J=(H=K.value)==null?void 0:H.contentWindow)==null||J.scrollTo(0,m)),S.value=!0;try{const{html:O}=await t.post("__live-preview__/render",{id:g,content:i,interactable:d.value}),Q=_.value,Re=new Blob([O],{type:"text/html"});_.value=URL.createObjectURL(Re),await A(),await new Promise(xe=>{R.value.addEventListener("load",()=>{m&&u&&R.value.contentWindow.scrollTo(0,m),xe()},{once:!0})}),S.value=!1,P.value=!1,D.value=_.value,Q&&URL.revokeObjectURL(Q)}catch(O){console.error(O),P.value=!0,S.value=!1}finally{C.value=!1}}async function j({data:i}){if(i.type==="save"){e.events.emit(`${e.context}.save`);return}if(i.type==="link"){const u=new URL(i.href);if(u.origin!==window.location.origin){window.open(i.href,"_blank");return}if(["assets","media"].some(m=>u.pathname.startsWith(`/${m}/`)))return;let g=c(u).slice(1);g?(g=g.replace(/\/[^/]+?:.+$/,""),g=me("pages",g.replaceAll("/","+"))):g="site";try{e.isLoading=!0;const m=await e.get(F(g));e.set(m),e.isLoading=!1}catch(m){console.error(m)}}}function G(i){return!i||typeof i=="string"?i:i[e.translation.code]??Object.values(i)[0]}async function Ee(){const{isRegistered:i}=await v();i&&(p.value="active")}return{__sfc:!0,propsDefinition:M,props:r,panel:e,api:t,store:a,getNonLocalizedPath:c,openLicenseModal:v,assertActivationIntegrity:k,label:s,updateInterval:f,interactable:d,aspectRatio:L,logLevel:E,help:x,license:p,isRendering:C,showTransitionIframe:S,hasError:P,blobUrl:_,transitionBlobUrl:D,containerRect:q,container:N,iframe:R,transitionIframe:K,licenseButtonGroup:W,throttledRenderPreview:w,unsavedContent:B,updateSectionHeight:z,renderUnsavedContent:y,renderPreview:V,handleMessage:j,t:G,handleRegistration:Ee}}});var be=function(){var r=this,e=r._self._c,t=r._self._setupProxy;return e("k-section",{attrs:{label:t.label}},[e("k-button-group",{attrs:{slot:"options"},slot:"options"},[t.license&&t.license!=="active"?e("k-button-group",{ref:"licenseButtonGroup",attrs:{layout:"collapsed"}},[e("k-button",{attrs:{theme:"love",variant:"filled",size:"xs",link:"https://kirby.tools/live-preview#pricing",target:"_blank",text:t.panel.t("johannschopplich.preview.license.buy")}}),e("k-button",{attrs:{theme:"love",variant:"filled",size:"xs",icon:"key",text:t.panel.t("johannschopplich.preview.license.activate")},on:{click:function(a){return t.handleRegistration()}}})],1):r._e(),e("k-button",{attrs:{variant:"filled",size:"xs",icon:"live-preview-restart"},on:{click:function(a){return t.renderUnsavedContent()}}})],1),e("div",{ref:"container",staticClass:"klp-grid klp-min-h-[55dvh] klp-rounded-[var(--input-rounded)]",class:[t.isRendering&&"klp-pointer-events-none",t.transitionBlobUrl&&!t.hasError&&"k-shadow-md",(!t.transitionBlobUrl||t.hasError)&&"klp-border klp-border-dashed klp-border-[var(--color-gray-400)]"],style:{aspectRatio:t.aspectRatio,height:t.aspectRatio?"auto":`calc(100dvh - ${t.containerRect.top??0}px - var(--spacing-3))`,maxWidth:"100%"},attrs:{"data-theme":"passive"}},[t.transitionBlobUrl?e("iframe",{ref:"transitionIframe",staticClass:"klp-h-full klp-w-full klp-rounded-[var(--input-rounded)] klp-bg-white",class:[t.hasError&&"klp-pointer-events-none klp-opacity-0"],style:{gridArea:"1 / 1 / 1 / 1"},attrs:{src:t.transitionBlobUrl}}):r._e(),t.blobUrl?e("iframe",{ref:"iframe",staticClass:"klp-h-full klp-w-full klp-rounded-[var(--input-rounded)] klp-bg-white",class:[(t.showTransitionIframe||t.hasError)&&"klp-pointer-events-none klp-opacity-0"],style:{gridArea:"1 / 1 / 1 / 1"},attrs:{src:t.blobUrl}}):r._e(),t.hasError?e("div",{staticClass:"klp-flex klp-items-center klp-justify-center",style:{gridArea:"1 / 1 / 1 / 1"}},[e("k-button",{attrs:{variant:"filled",theme:"notice",icon:"alert",text:t.panel.t("johannschopplich.preview.error.render")},on:{click:function(a){return t.renderUnsavedContent({persistScrollPosition:!1})}}})],1):r._e()]),t.help?e("k-text",{staticClass:"k-help klp-mt-2",attrs:{html:t.help}}):r._e()],1)},ke=[],Le=we(ye,be,ke,!1,null,"89990c31");const _e=Le.exports;window.panel.plugin("johannschopplich/live-preview",{sections:{preview:_e},icons:{"live-preview-restart":'<path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772z" />'}})})();
