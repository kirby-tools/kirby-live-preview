(function(){"use strict";const e=window.Vue;function y(){return window.panel}function E(){return y().api}function J(){const o=E();return{load:({parent:n,name:t})=>o.get(`${n}/sections/${t}`)}}function V(){var r;return((r=e.getCurrentInstance())==null?void 0:r.proxy).$store}const G=e.computed;e.customRef,e.defineAsyncComponent,e.defineComponent,e.effectScope,e.getCurrentInstance,e.getCurrentScope,e.h,e.inject,e.isProxy,e.isReactive,e.isReadonly,e.isRef,e.isShallow,e.markRaw;const j=e.nextTick;e.onActivated,e.onBeforeMount;const H=e.onBeforeUnmount;e.onBeforeUpdate,e.onDeactivated,e.onErrorCaptured,e.onMounted,e.onRenderTracked,e.onRenderTriggered,e.onScopeDispose,e.onServerPrefetch,e.onUnmounted,e.onUpdated,e.provide,e.proxyRefs,e.reactive,e.readonly;const s=e.ref;e.shallowReactive,e.shallowReadonly,e.shallowRef,e.toRaw,e.toRef,e.toRefs,e.triggerRef,e.unref,e.useAttrs,e.useCssModule,e.useCssVars,e.useListeners,e.useSlots;const T=e.watch;e.watchEffect,e.watchPostEffect,e.watchSyncEffect;function Q(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function Y(o,r){let n,t=0;return function(...u){clearTimeout(n);const w=Date.now(),d=w-t,l=r-d;l<=0?(t=w,o.apply(this,u)):n=setTimeout(()=>{t=Date.now(),o.apply(this,u)},l)}}var q=Y;const K=Q(q),X=/^\.?\//;function Z(o="",r){return o.endsWith("/")?o:o+"/"}function ee(o=""){return o.startsWith("/")}function x(o=""){return ee(o)?o:"/"+o}function te(o){return o&&o!=="/"}function ne(o,...r){let n=o||"";for(const t of r.filter(c=>te(c)))if(n){const c=t.replace(X,"");n=Z(n)+c}else n=t;return n}const oe={blueprint:String,lock:[Boolean,Object],help:String,name:String,parent:String,timestamp:Number};function re(){const r=y().languages.map(t=>t.code);return{locales:r,getNonLocalizedPath:t=>{const u=(t instanceof URL?t:new URL(t)).pathname.split("/").filter(Boolean);return r.includes(u[0])&&u.shift(),x(u.join("/"))}}}const ae=["error","warn","info","debug"];function se(o,r,n,t,c,u,w,d){var l=typeof o=="function"?o.options:o;return r&&(l.render=r,l.staticRenderFns=n,l._compiled=!0),l._scopeId="data-v-"+u,{exports:o,options:l}}const A={...oe},ie=Object.assign({inheritAttrs:!1},{__name:"Preview",props:A,setup(o){const r=o,n=y(),t=E(),c=V(),{getNonLocalizedPath:u}=re(),w=s(),d=s(),l=s(),R=s(),B=s(),P=s(),_=s(!1),b=s(!1),L=s(!1),g=s(),I=s(),O=s({}),N=s(),m=s(),$=s();let v;const U=G(()=>c.getters["content/changes"]());T(U,(a,i)=>{v&&d.value!==!1&&JSON.stringify(a)!==JSON.stringify(i)&&v(a)},{deep:!0}),T(()=>n.language.code,()=>{h()}),(async()=>{const{load:a}=J(),i=await a({parent:r.parent,name:r.name});w.value=W(i.label)||n.t("johannschopplich.preview.label"),d.value=i.updateInterval,l.value=i.interactable,R.value=i.aspectRatio||void 0,B.value=i.help,P.value=ae.indexOf(i.logLevel),v=K(z,d.value||250),h(),await j(),R.value||(k(),window.addEventListener("resize",k)),window.addEventListener("message",S),n.events.on("page.changeTitle",h),n.events.on("file.sort",h)})(),H(()=>{window.removeEventListener("resize",k),window.removeEventListener("message",S),n.events.off("page.changeTitle",h),n.events.off("file.sort",h),g.value&&URL.revokeObjectURL(g.value)});function k(){O.value=N.value.getBoundingClientRect()}function h(a){v==null||v(U.value,a)}async function z(a,{persistScrollPosition:i=!0}={}){var D,M;if(_.value)return;_.value=!0;const f=n.view.path.startsWith("pages/")?n.view.path.slice(6).replaceAll("+","/"):void 0;let p=0;m.value&&(p=m.value.contentWindow.scrollY,(M=(D=$.value)==null?void 0:D.contentWindow)==null||M.scrollTo(0,p)),b.value=!0;try{const{html:C}=await t.post("__live-preview__/render",{id:f,content:a,interactable:l.value}),F=g.value,fe=new Blob([C],{type:"text/html"});g.value=URL.createObjectURL(fe),await j(),await new Promise(de=>{m.value.addEventListener("load",()=>{p&&i&&m.value.contentWindow.scrollTo(0,p),de()},{once:!0})}),b.value=!1,L.value=!1,I.value=g.value,F&&URL.revokeObjectURL(F)}catch(C){console.error(C),L.value=!0,b.value=!1}finally{_.value=!1}}async function S({data:a}){if(a.type==="save"){n.events.emit(`${n.context}.save`);return}if(a.type==="link"){const i=new URL(a.href);if(i.origin!==window.location.origin){window.open(a.href,"_blank");return}if(["assets","media"].some(p=>i.pathname.startsWith(`/${p}/`)))return;let f=u(i).slice(1);f?(f=f.replace(/\/[^\/]+?:.+$/,""),f=ne("pages",f.replaceAll("/","+"))):f="site";try{n.isLoading=!0;const p=await n.get(x(f));n.set(p),n.isLoading=!1}catch(p){console.error(p)}}}function W(a){return!a||typeof a=="string"?a:a[n.translation.code]??Object.values(a)[0]}return{__sfc:!0,propsDefinition:A,props:r,panel:n,api:t,store:c,getNonLocalizedPath:u,label:w,updateInterval:d,interactable:l,aspectRatio:R,help:B,logLevel:P,isRendering:_,showTransitionIframe:b,hasError:L,blobUrl:g,transitionBlobUrl:I,containerRect:O,container:N,iframe:m,transitionIframe:$,throttledRenderPreview:v,unsavedContent:U,updateSectionHeight:k,renderUnsavedContent:h,renderPreview:z,handleMessage:S,t:W}}});var le=function(){var r=this,n=r._self._c,t=r._self._setupProxy;return n("k-section",{attrs:{label:t.label}},[n("k-button-group",{attrs:{slot:"options",layout:"collapsed"},slot:"options"},[n("k-button",{attrs:{variant:"filled",size:"xs",icon:"live-preview-restart"},on:{click:function(c){return t.renderUnsavedContent()}}})],1),n("div",{ref:"container",staticClass:"klp-grid klp-min-h-[55dvh] klp-rounded-[var(--input-rounded)]",class:[t.isRendering&&"klp-pointer-events-none",t.transitionBlobUrl&&!t.hasError&&"k-shadow-md",(!t.transitionBlobUrl||t.hasError)&&"klp-border klp-border-dashed klp-border-[var(--color-gray-400)]"],style:{aspectRatio:t.aspectRatio,height:t.aspectRatio?"auto":`calc(100dvh - ${t.containerRect.top??0}px - var(--spacing-3))`,maxWidth:"100%"},attrs:{"data-theme":"passive"}},[t.transitionBlobUrl?n("iframe",{ref:"transitionIframe",staticClass:"klp-h-full klp-w-full klp-rounded-[var(--input-rounded)] klp-bg-white",class:[t.hasError&&"klp-pointer-events-none klp-opacity-0"],style:{gridArea:"1 / 1 / 1 / 1"},attrs:{src:t.transitionBlobUrl}}):r._e(),t.blobUrl?n("iframe",{ref:"iframe",staticClass:"klp-h-full klp-w-full klp-rounded-[var(--input-rounded)] klp-bg-white",class:[(t.showTransitionIframe||t.hasError)&&"klp-pointer-events-none klp-opacity-0"],style:{gridArea:"1 / 1 / 1 / 1"},attrs:{src:t.blobUrl}}):r._e(),t.hasError?n("div",{staticClass:"klp-flex klp-items-center klp-justify-center",style:{gridArea:"1 / 1 / 1 / 1"}},[n("k-button",{attrs:{variant:"filled",theme:"notice",icon:"alert",text:t.panel.t("johannschopplich.preview.error.render")},on:{click:function(c){return t.renderUnsavedContent({persistScrollPosition:!1})}}})],1):r._e()]),t.help?n("k-text",{staticClass:"k-help klp-mt-2",attrs:{html:t.help}}):r._e()],1)},ce=[],ue=se(ie,le,ce,!1,null,"e3a6c7c1");const pe=ue.exports;window.panel.plugin("johannschopplich/live-preview",{sections:{preview:pe},icons:{"live-preview-restart":'<path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772z" />'}})})();
